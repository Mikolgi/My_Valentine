<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–û–Ω–ª–∞–π–Ω-—Å–≤–∏–¥–∞–Ω–∏–µ üíå</title>
    <link rel="stylesheet" href="css/theme.css" />
    <script src="config.js"></script>
  </head>

  <body>
    <main class="wrap">
      <section class="card" style="padding:18px 16px 18px;">
        <div class="title">
          –û–∫, <span class="pink" id="nick">–õ—é–±–∏–º–∞—è</span>‚Ä¶ –≤—ã–±–µ—Ä–∏ –Ω–∞—à–µ –æ–Ω–ª–∞–π–Ω-—Å–≤–∏–¥–∞–Ω–∏–µ üíò
        </div>
        <p class="subtitle">–í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç. –ü–æ—Ç–æ–º (–ø–æ –∂–µ–ª–∞–Ω–∏—é) –≤—ã–±–µ—Ä–∏ –¥–µ–Ω—å.</p>

        <div class="grid" id="choices"></div>

        <div style="margin-top:14px;">
          <span class="pill" id="pickedPill" style="font-size:15px;">–í—ã–±—Ä–∞–Ω–æ: –Ω–∞–∂–º–∏ –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç ‚ú®</span>
        </div>

        <div style="margin-top:14px; text-align:left;">
          <div style="font-size:12px; color:rgba(47,34,34,.62); margin:0 0 6px 6px;">–î–µ–Ω—å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</div>
          <input
            id="day"
            type="date"
            style="width:100%; padding:14px 12px; border-radius:18px; border:1px solid rgba(255,95,158,.22); background:rgba(255,255,255,.78); font-size:16px;"
          />
        </div>

        <div style="margin-top:14px;">
          <button class="btn btnPrimary btnFull" id="continueBtn" disabled>–î–∞–ª—å—à–µ üíå</button>
          <div class="tip" style="margin-top:10px;">–ï—Å–ª–∏ –¥–µ–Ω—å –Ω–µ –≤—ã–±—Ä–∞–Ω ‚Äî –∑–Ω–∞—á–∏—Ç ‚Äú–∫–æ–≥–¥–∞ —Ç—ã —Å–≤–æ–±–æ–¥–Ω–∞‚Äù üòÑ</div>
        </div>
      </section>
    </main>

    <script>
      const cfg = window.VALENTINE_CONFIG || {};
      document.getElementById("nick").textContent = cfg.nickname || "–õ—é–±–∏–º–∞—è";

      const cardsWrap = document.getElementById("choices");
      const options = Array.isArray(cfg.dateOptions) && cfg.dateOptions.length ? cfg.dateOptions : [];

      // –ø—Ä–æ—Å—Ç–æ–π —Ä–∞–Ω–¥–æ–º –¥–ª—è "—Ä—É–ª–µ—Ç–∫–∏"
      const roulettePlans = Array.isArray(cfg.roulettePlans) && cfg.roulettePlans.length
        ? cfg.roulettePlans
        : [
            "üí¨ 3 –≤–æ–ø—Ä–æ—Å–∞ + 1 –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç: –æ—Ç–≤–µ—á–∞–µ–º —á–µ—Å—Ç–Ω–æ –ø–æ –æ—á–µ—Ä–µ–¥–∏",
            "üé¨ 20 –º–∏–Ω—É—Ç —Ñ–∏–ª—å–º–∞ + –æ–±—Å—É–∂–¥–µ–Ω–∏–µ: —á—Ç–æ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å –∏ –ø–æ—á–µ–º—É",
            "üé® –†–∏—Å—É–µ–º –¥—Ä—É–≥ –¥—Ä—É–≥–∞ 5 –º–∏–Ω—É—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç üòÑ",
            "üì∏ 3 —Ñ–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏: —Ä–∞—Å—Å–∫–∞–∂–∏ –∏—Å—Ç–æ—Ä–∏—é –∫ –∫–∞–∂–¥–æ–º—É",
            "ü´∂ 10 –º–∏–Ω—É—Ç: –≥–æ–≤–æ—Ä–∏–º –¥—Ä—É–≥ –¥—Ä—É–≥—É —Ç–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–µ–µ",
            "üìù –ú–∏–Ω–∏-quiz: –ø–æ 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥—Ä—É–≥ –¥—Ä—É–≥—É"
          ];

      function pickRandom(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
      }

      cardsWrap.innerHTML = options
        .map(
          (o) => `
        <div class="option"
             data-title="${(o.title || "").replace(/"/g, "&quot;")}"
             data-choice="${(o.title || "")} ${(o.emoji || "")}"
             data-note="${((o.note || "")).replace(/"/g, "&quot;")}">
          <div class="optionTitle">${o.title || ""} ${o.emoji || ""}</div>
          <p class="optionText">${o.subtitle || ""}</p>
        </div>
      `
        )
        .join("");

      const cards = document.querySelectorAll(".option");
      const pickedPill = document.getElementById("pickedPill");
      const continueBtn = document.getElementById("continueBtn");
      const day = document.getElementById("day");

      let choice = "";
      let note = "";

      // min date = today
      const t = new Date();
      const yyyy = t.getFullYear();
      const mm = String(t.getMonth() + 1).padStart(2, "0");
      const dd = String(t.getDate()).padStart(2, "0");
      day.min = `${yyyy}-${mm}-${dd}`;

      cards.forEach((c) => {
        c.addEventListener("click", () => {
          cards.forEach((x) => x.classList.remove("active"));
          c.classList.add("active");

          choice = c.dataset.choice;
          const title = (c.dataset.title || "").toLowerCase();

          if (title.includes("—Ä—É–ª–µ—Ç–∫–∞")) {
            note = pickRandom(roulettePlans);
            pickedPill.textContent = "–í—ã–±—Ä–∞–Ω–æ: " + choice + " ‚Ä¢ " + note;
          } else {
            note = c.dataset.note || "";
            pickedPill.textContent = "–í—ã–±—Ä–∞–Ω–æ: " + choice;
          }

          continueBtn.disabled = false;
        });
      });

      continueBtn.addEventListener("click", () => {
        const whenDay = day.value ? day.value : "–í –ª—é–±–æ–π –¥–µ–Ω—å";
        localStorage.setItem("online_choice", choice);
        localStorage.setItem("online_note", note);
        localStorage.setItem("online_when", whenDay);
        location.href = "food.html";
      });
    </script>
  </body>
</html>
